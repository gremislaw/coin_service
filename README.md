# üíö üíö üíö 
# Coin Service 

–°–µ—Ä–≤–∏—Å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π –≤–∞–ª—é—Ç–æ–π (–º–æ–Ω–µ—Ç–∫–∞–º–∏) —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤. –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω –Ω–∞ Go —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π REST API –¥–ª—è –ø–æ–∫—É–ø–∫–∏ –º–µ—Ä—á–∞, –ø–µ—Ä–µ–≤–æ–¥–∞ –º–æ–Ω–µ—Ç–æ–∫ –º–µ–∂–¥—É —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º–∏ –∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π. –°–µ—Ä–≤–∏—Å –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –≤—ã—Å–æ–∫—É—é –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏ –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å, –∏—Å–ø–æ–ª—å–∑—É—è PostgreSQL –≤ –∫–∞—á–µ—Å—Ç–≤–µ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ –¥–∞–Ω–Ω—ã—Ö.

## –û–ø–∏—Å–∞–Ω–∏–µ

–°–µ—Ä–≤–∏—Å –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º:

1. **–ü–æ–∫—É–ø–∞—Ç—å –º–µ—Ä—á** ‚Äî –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–æ–Ω–µ—Ç–∫–∏ –¥–ª—è –ø—Ä–∏–æ–±—Ä–µ—Ç–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–æ–≤ –∏–∑ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ –º–∞–≥–∞–∑–∏–Ω–∞.
2. **–ü–µ—Ä–µ–≤–æ–¥–∏—Ç—å –º–æ–Ω–µ—Ç–∫–∏** ‚Äî –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –º–æ–Ω–µ—Ç–∫–∏ –¥—Ä—É–≥–∏–º —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º –≤ –∑–Ω–∞–∫ –±–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç–∏ –∏–ª–∏ –ø–æ–¥–∞—Ä–∫–∞.
3. **–û—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏** ‚Äî –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –∏—Å—Ç–æ—Ä–∏—é –æ–ø–µ—Ä–∞—Ü–∏–π —Å –º–æ–Ω–µ—Ç–∫–∞–º–∏.

–ö–∞–∂–¥—ã–π —Å–æ—Ç—Ä—É–¥–Ω–∏–∫ –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –ø–æ–ª—É—á–∞–µ—Ç 1000 –º–æ–Ω–µ—Ç–æ–∫. –ë–∞–ª–∞–Ω—Å –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–º, –∞ –≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –∞—Ç–æ–º–∞—Ä–Ω–æ.

---

## –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

### –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –º–µ—Ç–æ–¥—ã:

- **POST** `/api/auth`:
  - –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∏–ª–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
  - –ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞:
    ```bash
    curl -X POST http://localhost:8080/api/auth \
      -H "Content-Type: application/json" \
      -d '{"username": "user1", "password": "pass123"}'
    ```
  - –ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞:
    ```json
    {"token": "JWT_TOKEN"}
    ```

- **GET** `/api/buy/:merch_id`:
  - –ü–æ–∫—É–ø–∫–∞ –º–µ—Ä—á–∞ –ø–æ –µ–≥–æ ID.
  - –ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞:
    ```bash
    curl -X POST http://localhost:8080/api/buy/1 \
      -H "Authorization: Bearer JWT_TOKEN"
    ```
  - –ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞:
    ```json
    "merch purchased successfully"
    ```

- **POST** `/api/sendCoin`:
  - –ü–µ—Ä–µ–≤–æ–¥ –º–æ–Ω–µ—Ç–æ–∫ –¥—Ä—É–≥–æ–º—É —Å–æ—Ç—Ä—É–¥–Ω–∏–∫—É.
  - –ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞:
    ```bash
    curl -X POST http://localhost:8080/api/sencCoin \
      -H "Authorization: Bearer JWT_TOKEN" \
      -H "Content-Type: application/json" \
      -d '{"toUser": 2, "amount": 100}'
    ```
  - –ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞:
    ```json
    "coins transferred successfully"
    ```

- **GET** `/api/info`:
  - –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ –±–∞–ª–∞–Ω—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
  - –ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞:
    ```bash
    curl -X GET http://localhost:8080/api/info \
      -H "Authorization: Bearer JWT_TOKEN"
    ```
  - –ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞:
    ```json
    {"coinHistory":{"received":[{"amount":50,"fromUser":"user1"}],"sent":[{"amount":50,"toUser":"user3"},{"amount":50,"toUser":"user3"},  {"amount":50,"toUser":"user3"}]},"coins":820,"inventory":[{"quantity":1,"type":"t-shirt"}]}

    ```

---

## –°—Ç–µ–∫ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π

- **Go** ‚Äî –æ—Å–Ω–æ–≤–Ω–æ–π —è–∑—ã–∫ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è.
- **PostgreSQL** ‚Äî –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –∏ –º–µ—Ä—á–∞.
- **JWT** ‚Äî –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏.
- **Docker** ‚Äî –¥–ª—è —É–ø–∞–∫–æ–≤–∫–∏ –∏ –∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–∏—Å–∞.
- **Unit-—Ç–µ—Å—Ç—ã** ‚Äî –ø–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º `Go testing`.

---

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫

### –õ–æ–∫–∞–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫

1. –ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:
   ```bash
   git clone https://github.com/your-username/avito-coin-service.git
   cd avito-coin-service
   ```

2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–∏—Å:
   ```bash
   make run
   ```

   –°–µ—Ä–≤–∏—Å –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ –∞–¥—Ä–µ—Å—É: `http://localhost:8080`.

---

## –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

- **DB_HOST** ‚Äî —Ö–æ—Å—Ç –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `localhost`).
- **DB_PORT** ‚Äî –ø–æ—Ä—Ç –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `5432`).
- **DB_USER** ‚Äî –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö.
- **DB_PASSWORD** ‚Äî –ø–∞—Ä–æ–ª—å –¥–ª—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö.
- **DB_NAME** ‚Äî –∏–º—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö.

---

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —á–µ—Ä–µ–∑ Docker

Docker Compose –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –ø–æ–¥–Ω—è—Ç–∏—è –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤:

<details>
  <summary><strong>docker-compose.yml</strong></summary>

```yaml
services:
  postgres:
    image: postgres:latest
    restart: always
    environment:
      POSTGRES_USER: avito
      POSTGRES_PASSWORD: avito
      POSTGRES_DB: avito_coin
    ports:
      - "5432:5432"
    volumes:
      - db_data:/var/lib/postgresql/data

  app:
    build: .
    container_name: avito_coin_service
    restart: on-failure
    depends_on: 
      - postgres
    environment:
      DB_HOST: "postgres"
      DB_PORT: "5432"
      DB_USER: "avito"
      DB_PASSWORD: "avito"
      DB_NAME: "avito_coin"
    ports:
      - "8080:8080"

volumes:
  db_data:
```
</details>

---

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–î–ª—è –≤–Ω–µ—Å–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

–î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å–µ—Ä–≤–∏—Å–∞ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è unit-—Ç–µ—Å—Ç—ã. –ß—Ç–æ–±—ã –∑–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã, –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:

```bash
make test
```

–ö–æ–¥ —Å–µ—Ä–≤–∏—Å–∞ –ø—Ä–æ–≤–µ—Ä–µ–Ω –ª–∏–Ω—Ç–µ—Ä–∞–º–∏ (—Å–º. .golangci-lint)

–¢–µ—Å—Ç—ã –ø–æ–∫—Ä—ã–≤–∞—é—Ç —Å–ª–µ–¥—É—é—â–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏:
- –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
- –ü–æ–∫—É–ø–∫–∞ –º–µ—Ä—á–∞.
- –ü–µ—Ä–µ–≤–æ–¥ –º–æ–Ω–µ—Ç–æ–∫ –º–µ–∂–¥—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏.
- –ü–æ–ª—É—á–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞ –∏ –∏—Å—Ç–æ—Ä–∏–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π.

**Load Testing**

–ó–∞–ø—É—Å–∫:
```bash
 make load_test
```

–†–µ–∑—É–ª—å—Ç–∞—Ç—ã:

    Duration 3s

    Get User Balance Test Results:
    Requests: 1510
    Success Rate: 100.00%
    Latency (mean): 845.329062ms
    Latency (95th percentile): 2.428142488s
    Latency (99th percentile): 3.207231881s
    Bytes In (mean): 96.35
    Bytes Out (mean): 0.00

    Buy Merch Test Results:
    Requests: 1519
    Success Rate: 98.88%
    Latency (mean): 1.030131828s
    Latency (95th percentile): 2.859686845s
    Latency (99th percentile): 3.542084777s
    Bytes In (mean): 43.04
    Bytes Out (mean): 0.00

    Transfer Coins Test Results:
    Requests: 1510
    Success Rate: 99.54%
    Latency (mean): 1.196866201s
    Latency (95th percentile): 3.041751118s
    Latency (99th percentile): 3.7649174s
    Bytes In (mean): 44.97
    Bytes Out (mean): 28.88

---

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

–ü—Ä–æ–µ–∫—Ç —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ —Å–ª–æ–µ–≤:
- **Handler** ‚Äî –æ–±—Ä–∞–±–æ—Ç–∫–∞ HTTP-–∑–∞–ø—Ä–æ—Å–æ–≤, –≤–∞–ª–∏–¥–∞—Ü–∏—è, –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ.
- **Service** ‚Äî –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞: –ø–æ–∫—É–ø–∫–∞ –º–µ—Ä—á–∞, –ø–µ—Ä–µ–≤–æ–¥ –º–æ–Ω–µ—Ç, —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–æ–º.
- **Repository** ‚Äî —Ä–∞–±–æ—Ç–∞ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö: —Å–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –º–µ—Ä—á–∞, —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π.

–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞:
```
‚îú‚îÄ‚îÄ cmd
‚îÇ   ‚îî‚îÄ‚îÄ main.go
‚îú‚îÄ‚îÄ internal
‚îÇ   ‚îú‚îÄ‚îÄ config
‚îÇ   ‚îú‚îÄ‚îÄ handler
‚îÇ   ‚îú‚îÄ‚îÄ repository
‚îÇ   ‚îú‚îÄ‚îÄ service
‚îÇ   ‚îî‚îÄ‚îÄ db
‚îú‚îÄ‚îÄ Dockerfile
‚îú‚îÄ‚îÄ docker-compose.yml
‚îú‚îÄ‚îÄ README.md
‚îî‚îÄ‚îÄ go.mod
```

---

## –ü—Ä–æ–±–ª–µ–º—ã

–°–µ—Ä–≤–∏—Å –Ω–µ –º–æ–≥ —É–¥–µ—Ä–∂–∞—Ç—å –≤—ã—Å–æ–∫—É—é –Ω–∞–≥—Ä—É–∑–∫—É –≤ 1000rps 

–Ø –ø—Ä–µ–¥–ø–æ–ª–æ–∂–∏–ª, —á—Ç–æ 1000 –≥–æ—Ä—É—Ç–∏–Ω —Å–∫–∞–ø–ª–∏–≤–∞–ª–∏—Å—å –∏–∑-–∑–∞ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –±–¥ –∏ —É–≤–µ–ª–∏—á–∏–ª —ç—Ç–æ—Ç –ø–æ—Ä–æ–≥

–†–µ—à–µ–Ω–∏–µ–º –±—ã–ª–æ —É–≤–µ–ª–∏—á–µ–Ω–∏–µ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∫–æ–Ω–Ω–µ–∫—Ç–æ–≤ –∫ –±–¥ –¥–æ 1000 –≤ —Ä—É—á–Ω—É—é –≤ –∫–æ–Ω—Ñ–∏–≥–∞—Ö –∏ –∑–∞–¥–∞—Ç—å –≤ —Å–µ—Ä–≤–∏—Å–µ –æ–≥—Ä–∞–Ω–∏—á–∏—Ç–µ–ª–∏ –∫–æ–Ω–Ω–µ–∫—Ç–æ–≤

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–¢–µ–ø–µ—Ä—å —É –≤–∞—Å –µ—Å—Ç—å –º–æ—â–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π –≤–∞–ª—é—Ç–æ–π! üöÄ

–°–µ—Ä–≤–∏—Å –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ, –Ω–∞—Å—Ç—Ä–æ–µ–Ω –Ω–∞ –≤—ã—Å–æ–∫—É—é –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏ –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å. –¢–µ–ø–µ—Ä—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ –º–æ–≥—É—Ç –ø–æ–∫—É–ø–∞—Ç—å –º–µ—Ä—á. üòé

–ò –ø–æ–º–Ω–∏—Ç–µ: "–ú–æ–Ω–µ—Ç–∫–∏ ‚Äî —ç—Ç–æ –Ω–µ –ø—Ä–æ—Å—Ç–æ –≤–∞–ª—é—Ç–∞, —ç—Ç–æ —Å–ø–æ—Å–æ–± —Å–∫–∞–∑–∞—Ç—å —Å–ø–∞—Å–∏–±–æ –∫–æ–ª–ª–µ–≥–µ!" ‚ú®

---
> **"–ù–µ —É–¥–µ—Ä–∂–∏–≤–∞–π —Ç–æ, —á—Ç–æ —É—Ö–æ–¥–∏—Ç, –∏ –Ω–µ –æ—Ç–≤–µ—Ä–≥–∞–π —Ç–æ, —á—Ç–æ –ø—Ä–∏—Ö–æ–¥–∏—Ç."**  
> ‚Äî –ö–æ–¥–æ –°–∞–≤–∞–∫–∏  
